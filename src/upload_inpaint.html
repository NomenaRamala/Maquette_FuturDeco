<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Futurdeco — Home Staging IA</title>
  <link rel="stylesheet" href="style.css">

  <style>
    :root {
      --accent: #0F172A;
      --muted: #6b7280;
      --bg: #f8fafc;
    }
    body {
      font-family: "Inter", Arial, sans-serif;
      color: var(--accent);
      margin: 0;
      padding: 0;
    }
    .page-wrapper{
      position:relative;
      min-height:100vh;
      padding-top:70px;
    }
    .page-bg{
      position:fixed;
      inset:0;
      background-image:url('./assets/hero.jpg');
      background-size:cover;
      background-position:center;
      filter:blur(6px);
      transform:scale(1.05);
      z-index:0;
    }
    .page-overlay{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.65);
      backdrop-filter:blur(2px);
      z-index:1;
    }
    .page-content{
      position:relative;
      z-index:2;
    }
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      padding: 24px;
    }
    h1 { text-align:center; margin-bottom:24px; }
    input[type=file], select {
      width: 100%;
      padding: 10px;
      border: 1px solid #d1d5db;
      border-radius: 8px;
      margin-bottom: 14px;
    }
    button {
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 10px 14px;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover { background: #1e293b; }
    .preview {
      display: flex;
      gap: 10px;
      justify-content: space-between;
      margin-top: 20px;
    }
    .preview img {
      width: 100%;
      max-width: 420px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .status { text-align: center; color: var(--muted); margin-top: 10px; }
    .options {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    .styles, .quality {
      flex: 1;
      min-width: 260px;
    }

    /* Header */
    .site-header{
      position:fixed;
      top:0; left:0;
      width:100%;
      height:70px;
      background:rgba(255,255,255,0.75);
      backdrop-filter:blur(10px);
      display:flex;
      align-items:center;
      z-index:50;
      border-bottom:1px solid rgba(255,255,255,0.4);
    }
    .header-inner{
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:700;
      font-size:20px;
      color:var(--accent);
    }
    .logo{ width:32px; }
    .nav{
      display:flex;
      gap:16px;
    }
    .nav-link{
      text-decoration:none;
      color:var(--accent);
    }
    .btn-primary{
      padding:8px 12px;
      background:var(--accent);
      color:white;
      border-radius:6px;
    }
    .menu-btn{ display:none; }

    @media(max-width:768px){
      .nav{ display:none; }
      .menu-btn{
        display:block;
        background:none;
        border:none;
        font-size:22px;
      }
      .mobile-nav{
        display:none;
        flex-direction:column;
        background:white;
        padding:20px;
        text-align:center;
      }
      .mobile-link{
        margin-bottom:8px;
        color:var(--accent);
        text-decoration:none;
      }
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand">
        <img src="./assets/Logo.svg" alt="Logo Futurdeco" class="logo">
        Futurdeco
      </a>
      <nav class="nav">
        <a href="index.html#services" class="nav-link">Services</a>
        <a href="index.html#apropos" class="nav-link">À propos</a>
        <a href="index.html#contact" class="nav-link">Contact</a>
        <a href="upload.html" class="nav-link">Générer</a>
        <a href="upload_inpaint.html" class="nav-link">Inpaint</a>
        <a href="login.html" class="btn-primary">Connexion</a>
      </nav>

      <button id="btnMenu" class="menu-btn">☰</button>
    </div>

    <div id="mobileNav" class="mobile-nav">
      <a href="index.html#services" class="mobile-link">Services</a>
      <a href="index.html#apropos" class="mobile-link">À propos</a>
      <a href="index.html#contact" class="mobile-link">Contact</a>
      <a href="upload.html" class="mobile-link">Générer</a>
      <a href="upload_inpaint.html" class="mobile-link">Inpaint</a>
      <a href="login.html" class="mobile-link btn-primary">Connexion</a>
    </div>
  </header>


  <div class="page-wrapper">
    <div class="page-bg"></div>
    <div class="page-overlay"></div>

    <div class="page-content">
      <div class="container">

        <h1>Home Staging Virtuel — Inpaint IA</h1>

        <label>Importer une photo de la pièce vide :</label>
        <input type="file" id="file" accept="image/*" />

        <div class="options">
          <div class="styles">
            <label>Choisir un style :</label>
            <select id="style">
              <option value="modern">Moderne</option>
              <option value="scandinavian">Scandinave</option>
              <option value="luxury">Luxueux</option>
              <option value="minimalist">Minimaliste</option>
              <option value="industrial">Industriel</option>
            </select>
          </div>

          <div class="quality">
            <label>Qualité du rendu :</label>
            <select id="quality">
              <option value="fast">Rapide</option>
              <option value="high">Haute</option>
            </select>
          </div>
        </div>

        <button id="generateBtn">Générer la décoration</button>

        <div class="status" id="status"></div>

        <div class="preview" id="preview">
          <div id="originalBox">Aucune image chargée</div>
          <div id="generatedBox"></div>
        </div>
      </div>
    </div>
  </div>


<script>
  const fileInput = document.getElementById("file");
  const origBox = document.getElementById("originalBox");
  const genBox = document.getElementById("generatedBox");
  const generateBtn = document.getElementById("generateBtn");
  const statusEl = document.getElementById("status");
  const style = document.getElementById("style");
  const quality = document.getElementById("quality");

  let imageFile = null;

  fileInput.addEventListener("change", (e) => {
    imageFile = e.target.files[0];
    if (imageFile) {
      const url = URL.createObjectURL(imageFile);
      origBox.innerHTML = `<img src="${url}" alt="original">`;
    }
  });

  generateBtn.addEventListener("click", async () => {
    if (!imageFile) return alert("Choisis une image d'abord !");
    
    statusEl.textContent = "Génération en cours... ⏳";
    genBox.innerHTML = "";

    const formData = new FormData();
    formData.append("image", imageFile);
    formData.append("style", style.value);
    formData.append("quality", quality.value);

    try {
      const res = await fetch("/api/stage", {
        method: "POST",
        body: formData,
      });

      const json = await res.json();
      
      if (!res.ok) {
        console.error("Erreur API:", json);
        statusEl.textContent = `Erreur ${res.status}: ${json.error || 'Erreur inconnue'}`;
        if (json.details) {
          statusEl.textContent += ` (${json.details})`;
        }
        return;
      }

      const resultUrl = json.resultUrl || json.result_url; // Support des deux formats
      if (!resultUrl) {
        console.error("Réponse du serveur:", json); // Log pour débogage
        throw new Error("Aucune URL de résultat valide reçue du serveur");
      }

      console.log("URL de l'image générée:", resultUrl); // Log pour débogage
      genBox.innerHTML = `<img src="${resultUrl}" alt="généré" style="max-width: 100%; height: auto;">`;
      statusEl.textContent = "✅ Génération terminée.";

    } catch (err) {
      console.error("Erreur lors de la requête:", err);
      statusEl.textContent = `Erreur: ${err.message || 'Erreur inconnue'}`;
      
      // Afficher plus de détails dans la console
      if (err.response) {
        console.error("Détails de l'erreur:", {
          status: err.response.status,
          statusText: err.response.statusText,
          data: err.response.data
        });
      }
    }
  });

  // Mobile nav
  const btnMenu = document.getElementById("btnMenu");
  const mobileNav = document.getElementById("mobileNav");
  btnMenu.addEventListener("click", () => {
    mobileNav.style.display = mobileNav.style.display === "flex" ? "none" : "flex";
  });
</script>

</body>
</html>
